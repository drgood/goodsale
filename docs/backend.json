
{
  "entities": {
    "Tenant": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Tenant",
      "type": "object",
      "description": "Represents a tenant (shop) in the multi-tenant system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the tenant."
        },
        "name": {
          "type": "string",
          "description": "Name of the tenant (shop)."
        },
        "subdomain": {
          "type": "string",
          "description": "Subdomain for the tenant (e.g., shopname.goodsale.app)."
        },
        "plan": {
          "type": "string",
          "description": "Subscription plan of the tenant (e.g., Starter, Growth)."
        },
        "status": {
          "type": "string",
          "description": "Status of the tenant (e.g., active, suspended)."
        }
      },
      "required": [
        "id",
        "name",
        "subdomain",
        "plan",
        "status"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to Tenant. (Relationship: Tenant 1:N User)"
        },
        "name": {
          "type": "string",
          "description": "Name of the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "Role of the user (e.g., Owner, Manager, Cashier)."
        }
      },
      "required": [
        "id",
        "tenantId",
        "name",
        "email",
        "role"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product in the inventory.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to Tenant. (Relationship: Tenant 1:N Product)"
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "sku": {
          "type": "string",
          "description": "Stock Keeping Unit of the product."
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to Category. (Relationship: Category 1:N Product)"
        },
        "supplierId": {
          "type": "string",
          "description": "Reference to Supplier. (Relationship: Supplier 1:N Product)"
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "stock": {
          "type": "number",
          "description": "Current stock level of the product."
        },
        "barcode": {
          "type": "string",
          "description": "Barcode of the product."
        }
      },
      "required": [
        "id",
        "tenantId",
        "name",
        "sku",
        "categoryId",
        "supplierId",
        "price",
        "stock"
      ]
    },
    "Sale": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Sale",
      "type": "object",
      "description": "Represents a sale transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the sale."
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to Tenant. (Relationship: Tenant 1:N Sale)"
        },
        "shiftId": {
          "type": "string",
          "description": "Reference to the Shift session. (Relationship: Shift 1:N Sale)"
        },
        "cashierId": {
          "type": "string",
          "description": "Reference to User (Cashier). (Relationship: User 1:N Sale)"
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of the sale."
        },
        "paymentMethod": {
          "type": "string",
          "description": "Payment method used for the sale."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the sale was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "tenantId",
        "shiftId",
        "cashierId",
        "totalAmount",
        "paymentMethod",
        "createdAt"
      ]
    },
    "SaleItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SaleItem",
      "type": "object",
      "description": "Represents an item in a sale.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the sale item."
        },
        "saleId": {
          "type": "string",
          "description": "Reference to Sale. (Relationship: Sale 1:N SaleItem)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N SaleItem)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product sold."
        },
        "price": {
          "type": "number",
          "description": "Price of the product at the time of sale."
        }
      },
      "required": [
        "id",
        "saleId",
        "productId",
        "quantity",
        "price"
      ]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a product category.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the category."
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to Tenant. (Relationship: Tenant 1:N Category)"
        },
        "name": {
          "type": "string",
          "description": "Name of the category."
        }
      },
      "required": [
        "id",
        "tenantId",
        "name"
      ]
    },
    "Supplier": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Supplier",
      "type": "object",
      "description": "Represents a product supplier.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the supplier."
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to Tenant. (Relationship: Tenant 1:N Supplier)"
        },
        "name": {
          "type": "string",
          "description": "Name of the supplier."
        }
      },
      "required": [
        "id",
        "tenantId",
        "name"
      ]
    },
    "Setting": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Setting",
      "type": "object",
      "description": "Represents tenant-specific settings.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the setting."
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to Tenant. (Relationship: Tenant 1:N Setting)"
        },
        "shopName": {
          "type": "string",
          "description": "Name of the shop."
        },
        "logoUrl": {
          "type": "string",
          "description": "URL of the shop's logo."
        },
        "receiptHeader": {
          "type": "string",
          "description": "Header text for receipts."
        },
        "receiptFooter": {
          "type": "string",
          "description": "Footer text for receipts."
        },
        "taxRate": {
          "type": "number",
          "description": "Tax rate for the shop."
        },
        "currency": {
          "type": "string",
          "description": "Currency used by the shop."
        },
        "posSettings": {
          "type": "string",
          "description": "JSON object to store POS settings"
        }
      },
      "required": [
        "id",
        "tenantId"
      ]
    },
    "Shift": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Shift",
      "type": "object",
      "description": "Represents a cashier's work session.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the shift."
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to Tenant."
        },
        "cashierId": {
          "type": "string",
          "description": "Reference to the User (cashier)."
        },
        "cashierName": {
          "type": "string",
          "description": "Name of the cashier (denormalized)."
        },
        "startTime": {
          "type": "string",
          "format": "date-time"
        },
        "endTime": {
          "type": "string",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "enum": ["open", "closed"]
        },
        "startingCash": { "type": "number" },
        "cashSales": { "type": "number" },
        "cardSales": { "type": "number" },
        "mobileSales": { "type": "number" },
        "creditSales": { "type": "number" },
        "totalSales": { "type": "number" },
        "expectedCash": { "type": "number" },
        "actualCash": { "type": "number" },
        "cashDifference": { "type": "number" }
      },
      "required": ["id", "tenantId", "cashierId", "startTime", "status", "startingCash"]
    },
    "ShiftReport": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "ShiftReport",
        "type": "object",
        "description": "A report generated at the end of a shift.",
        "properties": {
            "id": { "type": "string" },
            "shiftId": { "type": "string" },
            "tenantId": { "type": "string" },
            "generatedAt": { "type": "string", "format": "date-time" },
            "cashierName": { "type": "string" },
            "details": { "$ref": "#/backend/entities/Shift" }
        },
        "required": ["id", "shiftId", "tenantId", "generatedAt"]
    },
    "DebtorHistory": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "DebtorHistory",
        "type": "object",
        "description": "Tracks payments and new credits for a customer's balance.",
        "properties": {
            "id": { "type": "string" },
            "customerId": { "type": "string" },
            "saleId": { "type": "string" },
            "amount": { "type": "number" },
            "type": { "type": "string", "enum": ["credit", "payment"] },
            "date": { "type": "string", "format": "date-time" }
        },
        "required": ["id", "customerId", "amount", "type", "date"]
    },
    "AuditLog": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "AuditLog",
        "type": "object",
        "description": "Logs significant actions performed by users.",
        "properties": {
            "id": { "type": "string" },
            "userId": { "type": "string" },
            "userName": { "type": "string" },
            "action": { "type": "string", "description": "e.g., 'update_product', 'delete_sale'" },
            "entity": { "type": "string", "description": "e.g., 'Product', 'Sale'" },
            "entityId": { "type": "string" },
            "timestamp": { "type": "string", "format": "date-time" },
            "details": { "type": "object", "description": "Stores before/after values or other context." }
        },
        "required": ["id", "userId", "action", "entity", "entityId", "timestamp"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/tenants/{tenantId}",
        "definition": {
          "entityName": "Tenant",
          "schema": {
            "$ref": "#/backend/entities/Tenant"
          },
          "description": "Stores tenant information. This serves as the root document for all tenant-specific data.",
          "params": [
            {
              "name": "tenantId",
              "description": "Unique identifier for the tenant."
            }
          ]
        }
      },
      {
        "path": "/tenants/{tenantId}/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user information. Includes denormalized 'tenantId' for authorization independence.",
          "params": [
            {
              "name": "tenantId",
              "description": "Unique identifier for the tenant."
            },
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/tenants/{tenantId}/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information. Includes denormalized 'tenantId' for authorization independence.",
          "params": [
            {
              "name": "tenantId",
              "description": "Unique identifier for the tenant."
            },
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/tenants/{tenantId}/sales/{saleId}",
        "definition": {
          "entityName": "Sale",
          "schema": {
            "$ref": "#/backend/entities/Sale"
          },
          "description": "Stores sale transaction information. Includes denormalized 'tenantId' for authorization independence.",
          "params": [
            {
              "name": "tenantId",
              "description": "Unique identifier for the tenant."
            },
            {
              "name": "saleId",
              "description": "Unique identifier for the sale."
            }
          ]
        }
      },
      {
        "path": "/tenants/{tenantId}/sales/{saleId}/saleItems/{saleItemId}",
        "definition": {
          "entityName": "SaleItem",
          "schema": {
            "$ref": "#/backend/entities/SaleItem"
          },
          "description": "Stores sale item information. Includes denormalized 'tenantId' via the parent 'saleId' for authorization independence.",
          "params": [
            {
              "name": "tenantId",
              "description": "Unique identifier for the tenant."
            },
            {
              "name": "saleId",
              "description": "Unique identifier for the sale."
            },
            {
              "name": "saleItemId",
              "description": "Unique identifier for the sale item."
            }
          ]
        }
      },
      {
        "path": "/tenants/{tenantId}/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Stores category information. Includes denormalized 'tenantId' for authorization independence.",
          "params": [
            {
              "name": "tenantId",
              "description": "Unique identifier for the tenant."
            },
            {
              "name": "categoryId",
              "description": "Unique identifier for the category."
            }
          ]
        }
      },
      {
        "path": "/tenants/{tenantId}/suppliers/{supplierId}",
        "definition": {
          "entityName": "Supplier",
          "schema": {
            "$ref": "#/backend/entities/Supplier"
          },
          "description": "Stores supplier information. Includes denormalized 'tenantId' for authorization independence.",
          "params": [
            {
              "name": "tenantId",
              "description": "Unique identifier for the tenant."
            },
            {
              "name": "supplierId",
              "description": "Unique identifier for the supplier."
            }
          ]
        }
      },
      {
        "path": "/tenants/{tenantId}/settings/{settingId}",
        "definition": {
          "entityName": "Setting",
          "schema": {
            "$ref": "#/backend/entities/Setting"
          },
          "description": "Stores setting information. Includes denormalized 'tenantId' for authorization independence.",
          "params": [
            {
              "name": "tenantId",
              "description": "Unique identifier for the tenant."
            },
            {
              "name": "settingId",
              "description": "Unique identifier for the setting."
            }
          ]
        }
      },
      {
        "path": "/tenants/{tenantId}/shifts/{shiftId}",
        "definition": {
            "entityName": "Shift",
            "schema": { "$ref": "#/backend/entities/Shift" },
            "description": "Stores cashier shift sessions.",
            "params": [
                { "name": "tenantId", "description": "Unique identifier for the tenant." },
                { "name": "shiftId", "description": "Unique identifier for the shift." }
            ]
        }
      },
      {
        "path": "/tenants/{tenantId}/shiftReports/{reportId}",
        "definition": {
            "entityName": "ShiftReport",
            "schema": { "$ref": "#/backend/entities/ShiftReport" },
            "description": "Stores generated end-of-shift reports.",
            "params": [
                { "name": "tenantId", "description": "Unique identifier for the tenant." },
                { "name": "reportId", "description": "Unique identifier for the report." }
            ]
        }
      }
    ],
    "reasoning": "This Firestore structure is designed for a multi-tenant SaaS application, GoodSale, focusing on inventory and POS management. It adheres to the principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules are not Filters). Each tenant's data is isolated using tenant-specific collections, ensuring data segregation and simplified security rules. All entities that should be associated with a given tenant id, live under a root tenant document for simplified and more secure data isolation. \n\nAuthorization Independence is achieved by denormalizing the `tenantId` into every document within the collections associated with a tenant. This eliminates the need for `get()` calls in security rules to verify the tenant context, enabling atomic operations and easier debugging. \n\nQAPs are supported by segregating data based on tenancy. List operations are secured by ensuring that all documents within a collection share the same security requirements, based on the `tenantId`. Global Roles are implemented in the database, which allow for streamlined management, and are also enforced via the security rules."
  }
}
